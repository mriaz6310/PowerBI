import pandas as pd

def descriptive_stats(df):
    # Ensure 'Event_Type' and 'Reopen_Deltas_int' columns exist
    if 'Event_Type' not in df.columns or 'Reopen_Deltas_int' not in df.columns:
        raise ValueError("Required columns are missing in the dataframe.")

    # Filter reopenings
    reopenings = df[df['Event_Type'] == 'IP-Level Ticket Reopened']

    # Check if there are any rows with 'IP-Level Ticket Reopened'
    if reopenings.empty:
        print("No rows with 'IP-Level Ticket Reopened' found.")
        return pd.DataFrame()  # Return an empty DataFrame

    # Group by the index (which is 'unique_ip_ticket_id') and calculate statistics
    grouped = reopenings.groupby(reopenings.index)['Reopen_Deltas_int']

    # Calculate statistics
    stats_df = grouped.agg([
        'count',                      # Number of reopenings
        'mean',                       # Mean
        'std',                        # Standard Deviation
        'median',                     # Median
        'min',                        # Minimum
        'max',                        # Maximum
        lambda x: x.quantile(0.25),   # 25th Percentile
        lambda x: x.quantile(0.75),   # 75th Percentile
        lambda x: x.quantile(0.05),   # 5th Percentile
        lambda x: x.quantile(0.95)    # 95th Percentile
    ]).reset_index()

    # Rename columns
    stats_df.columns = [
        'unique_ip_ticket_id',
        'Total Number of Reopenings',
        'Mean',
        'Standard Deviation',
        'Median',
        'Minimum',
        'Maximum',
        '25th Percentile',
        '75th Percentile',
        '5th Percentile',
        '95th Percentile'
    ]

    return stats_df

# Usage
desc_stats = descriptive_stats(deltas_explode)
print(desc_stats)
